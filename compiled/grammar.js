(function(){function Block(){return ASTBase.prototype.constructor.apply(this,arguments)}function File(){return Block.prototype.constructor.apply(this,arguments)}function BlockWithoutIndent(){return Block.prototype.constructor.apply(this,arguments)}function Statement(){return ASTBase.prototype.constructor.apply(this,arguments)}function LoopControlStatement(){return ASTBase.prototype.constructor.apply(this,arguments)}function ThrowStatement(){return ASTBase.prototype.constructor.apply(this,arguments)}function ReturnStatement(){return ASTBase.prototype.constructor.apply(this,arguments)}function IfStatement(){return ASTBase.prototype.constructor.apply(this,arguments)}function ElseStatement(){return ASTBase.prototype.constructor.apply(this,arguments)}function WhileStatement(){return ASTBase.prototype.constructor.apply(this,arguments)}function ForStatement(){return ASTBase.prototype.constructor.apply(this,arguments)}function AssignmentStatement(){return ASTBase.prototype.constructor.apply(this,arguments)}function WaitForStatement(){return ASTBase.prototype.constructor.apply(this,arguments)}function SimpleWaitForStatement(){return WaitForStatement.prototype.constructor.apply(this,arguments)}function WaitForExpression(){return ASTBase.prototype.constructor.apply(this,arguments)}function PauseForStatement(){return WaitForStatement.prototype.constructor.apply(this,arguments)}function RunInParallelBlock(){return ASTBase.prototype.constructor.apply(this,arguments)}function MultipleReturnValues(){return ASTBase.prototype.constructor.apply(this,arguments)}function ExpressionStatement(){return ASTBase.prototype.constructor.apply(this,arguments)}function BlankStatement(){return ASTBase.prototype.constructor.apply(this,arguments)}function Variable(){return ASTBase.prototype.constructor.apply(this,arguments)}function BinOp(){return ASTBase.prototype.constructor.apply(this,arguments)}function Expression(){return ASTBase.prototype.constructor.apply(this,arguments)}function UnaryExpression(){return ASTBase.prototype.constructor.apply(this,arguments)}function ExisentialCheck(){return ASTBase.prototype.constructor.apply(this,arguments)}function WhenExpression(){return ASTBase.prototype.constructor.apply(this,arguments)}function NumberConstant(){return ASTBase.prototype.constructor.apply(this,arguments)}function StringConstant(){return ASTBase.prototype.constructor.apply(this,arguments)}function RegexConstant(){return ASTBase.prototype.constructor.apply(this,arguments)}function IndexExpression(){return ASTBase.prototype.constructor.apply(this,arguments)}function PropertyAccess(){return ASTBase.prototype.constructor.apply(this,arguments)}function FunctionCallArgument(){return ASTBase.prototype.constructor.apply(this,arguments)}function FunctionCall(){return ASTBase.prototype.constructor.apply(this,arguments)}function ParenExpression(){return ASTBase.prototype.constructor.apply(this,arguments)}function ListExpression(){return ASTBase.prototype.constructor.apply(this,arguments)}function ListComprehension(){return ASTBase.prototype.constructor.apply(this,arguments)}function ObjectComprehension(){return ASTBase.prototype.constructor.apply(this,arguments)}function MapItem(){return ASTBase.prototype.constructor.apply(this,arguments)}function ImplicitMapItem(){return MapItem.prototype.constructor.apply(this,arguments)}function MapExpression(){return ASTBase.prototype.constructor.apply(this,arguments)}function ImplicitMapExpression(){return MapExpression.prototype.constructor.apply(this,arguments)}function Ellipsis(){return ASTBase.prototype.constructor.apply(this,arguments)}function FunctionDefArgument(){return ASTBase.prototype.constructor.apply(this,arguments)}function FunctionExpression(){return ASTBase.prototype.constructor.apply(this,arguments)}function ClassDefinition(){return ASTBase.prototype.constructor.apply(this,arguments)}function TryCatch(){return ASTBase.prototype.constructor.apply(this,arguments)}function SuperStatement(){return ASTBase.prototype.constructor.apply(this,arguments)}var ast,ASTBase,KAL_RESERVED,KAL_RVALUE_OK,JS_RESERVED,JS_RVALUE_OK,KEYWORDS,RVALUE_OK,Nodes,v,ki$3,kobj$3,__hasProp={}.hasOwnProperty,__extends=function(child,parent){function ctor(){this.constructor=child}for(var key in parent)__hasProp.call(parent,key)&&(child[key]=parent[key]);return ctor.prototype=parent.prototype,child.prototype=new ctor,child.__super__=parent.prototype,child},k$indexof=[].indexOf||function(item){for(var i=0,l=this.length;l>i;i++)if(i in this&&this[i]===item)return i;return-1};for(ast=require("./ast"),ASTBase=ast.ASTBase,KAL_RESERVED=["true","false","yes","no","on","off","function","method","task","return","if","else","unless","except","when","otherwise","and","or","but","xor","not","nor","bitwise","mod","new","while","until","for","class","exists","doesnt","exist","is","isnt","inherits","from","nothing","empty","null","break","continue","try","catch","throw","raise","fail","with","arguments","of","in","instanceof","property","value","parallel","series","pass","pause","until","me","this","typeof"],KAL_RVALUE_OK=["true","false","yes","no","on","off","me","this","super","arguments","none","nothing"],JS_RESERVED=["break","case","catch","continue","debugger","default","delete","do","else","finally","for","function","if","in","instanceof","new","return","switch","this","throw","try","typeof","var","void","while","with","class","enum","export","extends","import","super","implements","interface","let","package","private","protected","public","static","yield","null","true","false","undefined","const"],JS_RVALUE_OK=["this","null","true","false","undefined"],KEYWORDS=KAL_RESERVED.concat(JS_RESERVED),RVALUE_OK=KAL_RVALUE_OK.concat(JS_RVALUE_OK),__extends(Block,ASTBase),Block.prototype.parse=function(){for(this.req("NEWLINE"),this.lock(),this.req("INDENT"),this.lock(),this.statements=[];!this.opt("DEDENT");)this.statements.push(this.req(Statement)),this.lock()},__extends(File,Block),File.prototype.parse=function(){for(this.lock(),this.statements=[];!this.opt("EOF");)this.statements.push(this.req(Statement)),this.lock()},__extends(BlockWithoutIndent,Block),BlockWithoutIndent.prototype.parse=function(){for(this.req("NEWLINE"),this.lock(),this.statements=[];!this.opt("DEDENT","EOF");)this.statements.push(this.req(Statement)),this.lock();this.ts.prev()},__extends(Statement,ASTBase),Statement.prototype.parse=function(){this.statement=this.req(BlankStatement,TryCatch,ClassDefinition,ReturnStatement,WaitForStatement,SimpleWaitForStatement,PauseForStatement,IfStatement,WhileStatement,ForStatement,ThrowStatement,SuperStatement,RunInParallelBlock,LoopControlStatement,AssignmentStatement,ExpressionStatement)},__extends(LoopControlStatement,ASTBase),LoopControlStatement.prototype.parse=function(){this.control=this.req_val("break","continue")},__extends(ThrowStatement,ASTBase),ThrowStatement.prototype.parse=function(){var specifier;specifier=this.req_val("throw","raise","fail"),this.lock(),"fail"===specifier.value?this.req_val("with"):void 0,this.expr=this.req(Expression),this.conditional=this.expr.transform_when_statement()},__extends(ReturnStatement,ASTBase),ReturnStatement.prototype.parse=function(){var expr;if(this.req_val("return"),this.lock(),this.conditional=this.opt(WhenExpression),this.exprs=[],null==this.conditional&&(expr=this.opt(Expression),null!=expr)){for(this.exprs.push(expr);this.opt_val(",");)expr=this.req(Expression),this.exprs.push(expr);null!=expr&&(this.conditional=expr.transform_when_statement())}},__extends(IfStatement,ASTBase),IfStatement.prototype.parse=function(){var keep_going,got_raw_else,new_else;for(this.condition=this.req_val("if","unless","when","except"),this.lock(),"except"===this.condition.value?this.req_val("when"):void 0,this.conditional=this.req(Expression),this.block=this.req(Block,Statement),this.elses=[],keep_going=!0,got_raw_else=!1;keep_going;)new_else=this.opt(ElseStatement),null==new_else?keep_going=!1:(this.elses.push(new_else),null==new_else.conditional&&(keep_going=!1))},__extends(ElseStatement,ASTBase),ElseStatement.prototype.parse=function(){this.req_val("else","otherwise"),this.lock(),this.opt_val("if")&&(this.conditional=this.req(Expression)),this.block=this.req(Block,Statement)},__extends(WhileStatement,ASTBase),WhileStatement.prototype.parse=function(){this.specifier=this.req_val("while","until"),this.lock(),this.expr=this.req(Expression),this.block=this.req(Block)},__extends(ForStatement,ASTBase),ForStatement.prototype.parse=function(){this.req_val("for"),this.lock(),this.execution_style=this.opt_val("parallel","series"),this.iterant=this.req(Variable),this.type=this.req_val("in","of"),this.iterable=this.req(Expression),this.loop_block=this.req(Block)},__extends(AssignmentStatement,ASTBase),AssignmentStatement.prototype.parse=function(){this.lvalue=this.req(UnaryExpression),this.lvalue.can_be_lvalue=!0,this.assignOp=this.req("LITERAL"),k$indexof.call(["+","-","*","/","="],this.assignOp.value)>=0?void 0:this.error("invalid operator "+this.assignOp.value),"="!==this.assignOp.value&&this.req_val("="),this.lock(),this.lvalue.is_lvalue()?void 0:this.error("invalid assignment - the left side must be assignable"),this.rvalue=this.req(Expression),this.conditional=this.rvalue.transform_when_statement()},__extends(WaitForStatement,ASTBase),WaitForStatement.prototype.parse=function(){var last_accessor;this.no_errors=this.opt_val("safe"),this.req_val("wait"),this.req_val("for"),this.lvalue=this.req(MultipleReturnValues),this.lvalue.can_be_lvalue=!0,this.req_val("from"),this.lock(),this.lvalue.is_lvalue()?void 0:this.error("invalid assignment - the left side must be assignable"),this.rvalue=this.req(UnaryExpression),this.conditional=this.opt(WhenExpression),last_accessor=this.rvalue.accessors[this.rvalue.accessors.length-1],last_accessor instanceof FunctionCall?void 0:this.error("expected a function call after 'from'"),this.block=this.req(BlockWithoutIndent)},__extends(SimpleWaitForStatement,WaitForStatement),SimpleWaitForStatement.prototype.parse=function(){var last_accessor;this.no_errors=this.opt_val("safe"),this.req_val("wait"),this.lock(),this.req_val("for"),this.lvalue=null,this.rvalue=this.req(UnaryExpression),this.conditional=this.opt(WhenExpression),last_accessor=this.rvalue.accessors[this.rvalue.accessors.length-1],last_accessor instanceof FunctionCall?void 0:this.error("expected a function call after 'for'"),this.block=this.req(BlockWithoutIndent)},__extends(WaitForExpression,ASTBase),WaitForExpression.prototype.parse=function(){var explicit,last_accessor;this.no_errors=this.opt_val("safe"),this.no_errors?this.lock():void 0,explicit=this.opt_val("wait"),this.explicit?this.lock():void 0,explicit?this.req_val("for"):void 0,this.lvalue=this.opt(MultipleReturnValues),null!=this.lvalue?this.req_val("from"):void 0,this.rvalue=this.req(UnaryExpression),this.lock(),this.conditional=this.opt(WhenExpression),last_accessor=this.rvalue.accessors[this.rvalue.accessors.length-1],last_accessor instanceof FunctionCall?void 0:this.error("expected a function call after 'for'"),this.req("NEWLINE")},__extends(PauseForStatement,WaitForStatement),PauseForStatement.prototype.parse=function(){this.req_val("pause"),this.lock(),this.req_val("for"),this.tvalue=this.req(Expression),this.opt_val("second","seconds"),this.conditional=this.opt(WhenExpression),this.block=this.req(BlockWithoutIndent)},__extends(RunInParallelBlock,ASTBase),RunInParallelBlock.prototype.parse=function(){this.req_val("run"),this.opt_val("in"),this.req_val("parallel"),this.lock(),this.req("NEWLINE"),this.req("INDENT"),this.wait_fors=this.req_multi(WaitForExpression),this.lock(),this.req("DEDENT")},__extends(MultipleReturnValues,ASTBase),MultipleReturnValues.prototype.is_lvalue=function(){var arg,ki$1,kobj$1;for(kobj$1=this.arguments,ki$1=0;kobj$1.length>ki$1;ki$1++)if(arg=kobj$1[ki$1],!arg.is_lvalue())return!1;return!0},MultipleReturnValues.prototype.parse=function(){var left_paren,t,arg;for(left_paren=this.opt_val("("),this.arguments=[],t={value:","};","===t.value;)arg=this.req(UnaryExpression),arg.can_be_lvalue=!0,this.arguments.push(arg),t=left_paren?this.req_val(")","from",","):this.req_val("from",",");this.ts.prev(),left_paren?this.req_val(")"):void 0},__extends(ExpressionStatement,ASTBase),ExpressionStatement.prototype.parse=function(){this.expr=this.req(Expression)},__extends(BlankStatement,ASTBase),BlankStatement.prototype.parse=function(){this.opt_val("pass")?(this.lock(),this.req("NEWLINE","EOF"),this.ts.prev()):this.req("NEWLINE")},__extends(Variable,ASTBase),Variable.prototype.parse=function(){this.identifier=this.req("IDENTIFIER"),this.lock(),this.value=this.identifier.value,k$indexof.call(KEYWORDS,this.value)>=0?this.error("'"+this.value+"' is reserved and can't be used as a name"):void 0},__extends(BinOp,ASTBase),BinOp.prototype.parse=function(){this.invert=!1,this.bitwise=this.opt_val("bitwise"),this.op=this.req("IDENTIFIER","LITERAL"),this.bitwise&&"not"!==this.op.value?this.lock():void 0,"LITERAL"===this.op.type?(k$indexof.call([")","]","}",";",":",","],this.op.value)>=0?this.error("unexpected operator "+this.op.value):void 0,this.lock(),k$indexof.call(["+","-","*","/",">","<","^","<=",">=","==","!="],this.op.value)>=0?void 0:this.error("unexpected operator "+this.op.value)):("not"===this.op.value&&(this.op=this.req_val("in","of"),this.invert=!0),this.bitwise?k$indexof.call(["and","or","xor","left","right"],this.op.value)>=0?void 0:this.error("unexpected operator "+this.op.value):k$indexof.call(["and","but","or","xor","nor","in","mod","is","isnt","instanceof","of"],this.op.value)>=0?void 0:this.error("unexpected operator "+this.op.value))},__extends(Expression,ASTBase),Expression.prototype.transform_when_statement=function(){var rv;return null!=this.conditional&&null==this.conditional.false_expr?(rv=this.conditional,this.conditional=null,rv):this.right instanceof Expression?this.right.transform_when_statement():null},Expression.prototype.parse=function(){this.left=this.req(UnaryExpression),this.left.can_be_lvalue=!1,this.left.base instanceof FunctionExpression||(this.op=this.opt(BinOp),this.lock(),null!=this.op&&(this.right=this.req(Expression)),"DEDENT"!==this.ts.peek(-1).type&&(this.conditional=this.opt(WhenExpression)))},Expression.prototype.number_constant=function(){return null!=this.op||null!=this.conditional?null:this.left.number_constant()},__extends(UnaryExpression,ASTBase),UnaryExpression.prototype.is_lvalue=function(){var accessor,ki$2,kobj$2;if(this.can_be_lvalue===!1)return!1;if(k$indexof.call([NumberConstant,StringConstant,RegexConstant],this.base.constructor)>=0)return!1;if(this.accessors.length>0){if(k$indexof.call(KEYWORDS,this.base.value)>=0&&!(k$indexof.call(RVALUE_OK,this.base.value)>=0))return!1}else if(k$indexof.call(KEYWORDS,this.base.value)>=0)return!1;for(kobj$2=this.accessors,ki$2=0;kobj$2.length>ki$2;ki$2++)if(accessor=kobj$2[ki$2],accessor instanceof FunctionCall)return!1;return!0},UnaryExpression.prototype.parse=function(){var first;this.bitwise=this.opt_val("bitwise"),this.preop=this.opt_val("not","new","-","typeof"),this.bitwise&&"not"!==(null!=this.preop?this.preop.value:void 0)&&this.error("expected 'not' after 'bitwise' for a unary expression"),this.base=this.req(ParenExpression,ListExpression,MapExpression,FunctionExpression,ImplicitMapExpression,NumberConstant,StringConstant,RegexConstant,"IDENTIFIER"),this.base instanceof FunctionExpression?(this.accessors=[],first=this.opt(IndexExpression,PropertyAccess,ExisentialCheck),null!=first&&(this.accessors.push(first),this.accessors=this.accessors.concat(this.opt_multi(IndexExpression,FunctionCall,PropertyAccess,ExisentialCheck)))):this.accessors=this.opt_multi(IndexExpression,FunctionCall,PropertyAccess,ExisentialCheck),this.lock(),null!=this.base.value&&k$indexof.call(KEYWORDS,this.base.value)>=0&&!(k$indexof.call(RVALUE_OK,this.base.value)>=0)&&this.error("'"+this.base.value+"' is a reserved word and can't be used as a name")},UnaryExpression.prototype.number_constant=function(){var n;return null!=this.bitwise||null!=this.preop?null:this.base instanceof NumberConstant?(n=Number(this.base.token.text),isNaN(n)?null:n):null},__extends(ExisentialCheck,ASTBase),ExisentialCheck.prototype.parse=function(){var op;op=this.req_val("exists","?","doesnt"),this.lock(),"doesnt"===op.value?(this.req_val("exist"),this.invert=!0):this.invert=!1},__extends(WhenExpression,ASTBase),WhenExpression.prototype.parse=function(){this.specifier=this.req_val("when","except","if","unless"),this.lock(),"except"===this.specifier.value?this.req_val("when"):void 0,this.condition=this.req(Expression),this.opt_val("otherwise","else")&&(this.false_expr=this.req(Expression))},__extends(NumberConstant,ASTBase),NumberConstant.prototype.parse=function(){this.token=this.req("NUMBER")},__extends(StringConstant,ASTBase),StringConstant.prototype.parse=function(){this.token=this.req("STRING")},__extends(RegexConstant,ASTBase),RegexConstant.prototype.parse=function(){this.token=this.req("REGEX")},__extends(IndexExpression,ASTBase),IndexExpression.prototype.parse=function(){var op;op=this.req_val("[","?"),this.exisential="?"===op.value,this.exisential?this.req_val("["):void 0,this.lock(),this.expr=this.req(Expression),this.req_val("]")},__extends(PropertyAccess,ASTBase),PropertyAccess.prototype.parse=function(){var op;op=this.req_val(".","?"),this.exisential="?"===op.value,this.exisential?this.req_val("."):void 0,this.lock(),this.expr=this.req("IDENTIFIER")},__extends(FunctionCallArgument,ASTBase),FunctionCallArgument.prototype.parse=function(){this.val=this.req(Expression),this.lock(),")"===this.req_val(",",")").value&&this.ts.prev()},__extends(FunctionCall,ASTBase),FunctionCall.prototype.parse=function(){var op;op=this.req_val("(","?"),this.exisential="?"===op.value,this.exisential?this.req_val("("):void 0,this.lock(),this.arguments=this.opt_multi(FunctionCallArgument),this.req_val(")")},__extends(ParenExpression,ASTBase),ParenExpression.prototype.parse=function(){this.req_val("("),this.lock(),this.expr=this.req(Expression),this.req_val(")")},__extends(ListExpression,ASTBase),ListExpression.prototype.parse=function(){var item;if(this.req_val("["),this.lock(),this.comprehension=this.opt(ObjectComprehension,ListComprehension),null==this.comprehension)for(this.items=[],item=this.opt(Expression);item;)this.items.push(item),item=this.opt_val(",")?this.opt(Expression):null;this.req_val("]")},__extends(ListComprehension,ASTBase),ListComprehension.prototype.parse=function(){this.iter_expr=this.req(Expression),this.req_val("for"),this.lock(),this.iterant=this.req(Variable),this.req_val("in"),this.iterable=this.req(Expression)},__extends(ObjectComprehension,ASTBase),ObjectComprehension.prototype.parse=function(){this.iter_expr=this.req(Expression),this.req_val("for"),this.req_val("property"),this.lock(),this.opt_val("value")?this.value_iterant=this.req(Variable):(this.property_iterant=this.req(Variable),this.opt_val("with")&&(this.req_val("value"),this.value_iterant=this.req(Variable))),this.req_val("in"),this.iterable=this.req(Expression)},__extends(MapItem,ASTBase),MapItem.prototype.parse=function(){this.key=this.req("IDENTIFIER","STRING","NUMBER"),this.req_val(":"),this.lock(),this.val=this.req(Expression),this.end_token=this.req_val(",","}"),"}"===this.end_token.value&&this.ts.prev()},__extends(ImplicitMapItem,MapItem),ImplicitMapItem.prototype.parse=function(){this.key=this.req("IDENTIFIER","STRING","NUMBER"),this.req_val(":"),this.lock(),this.val=this.req(Expression),(null!=this.val.left?this.val.left.base:void 0)instanceof ImplicitMapExpression||(null!=this.val.left?this.val.left.base:void 0)instanceof FunctionExpression||(this.end_token=this.opt_multi("NEWLINE"),0===this.end_token.length&&(this.end_token=this.req_val(",")))},__extends(MapExpression,ASTBase),MapExpression.prototype.parse=function(){this.req_val("{"),this.lock(),this.items=this.opt_multi(MapItem),this.req_val("}")},__extends(ImplicitMapExpression,MapExpression),ImplicitMapExpression.prototype.parse=function(){this.req("NEWLINE"),this.indents=this.req_multi("INDENT"),this.lock(),this.items=this.req_multi(ImplicitMapItem),this.req("DEDENT")},__extends(Ellipsis,ASTBase),Ellipsis.prototype.parse=function(){this.req_val("."),this.req_val("."),this.req_val(".")},__extends(FunctionDefArgument,ASTBase),FunctionDefArgument.prototype.parse=function(){this.name=this.req(Variable),this.lock(),this.opt_val("=")&&(this.default=this.req(Expression)),")"===this.req_val(",",")").value&&this.ts.prev()},__extends(FunctionExpression,ASTBase),FunctionExpression.prototype.parse=function(){this.specifier=this.req_val("function","method","task"),this.lock(),this.name=this.opt(Variable),this.req_val("("),this.arguments=this.opt_multi(FunctionDefArgument),this.req_val(")"),this.late_bind=this.opt_val("of"),this.late_bind&&(this.lock(),this.bind_to=this.req(UnaryExpression)),this.block=this.req(Block)},__extends(ClassDefinition,ASTBase),ClassDefinition.prototype.parse=function(){this.req_val("class"),this.lock(),this.name=this.opt("IDENTIFIER"),this.opt_val("inherits")&&(this.req_val("from"),this.parent=this.req(Variable)),this.block=this.req(Block)},__extends(TryCatch,ASTBase),TryCatch.prototype.parse=function(){this.req_val("try"),this.lock(),this.try_block=this.req(Block),this.opt_val("catch")&&(this.lock(),this.identifier=this.opt("IDENTIFIER"),this.catch_block=this.req(Block))},__extends(SuperStatement,ASTBase),SuperStatement.prototype.parse=function(){this.req_val("super"),this.lock(),this.accessor=this.opt(FunctionCall)},Nodes=[ASTBase,File,Block,Statement,ThrowStatement,ReturnStatement,IfStatement,ElseStatement,WhileStatement,ForStatement,AssignmentStatement,ExpressionStatement,LoopControlStatement,BlankStatement,BinOp,Expression,UnaryExpression,ExisentialCheck,WhenExpression,NumberConstant,StringConstant,RegexConstant,IndexExpression,PropertyAccess,FunctionCallArgument,FunctionCall,ParenExpression,ListExpression,ListComprehension,ObjectComprehension,MapItem,MapExpression,ImplicitMapItem,ImplicitMapExpression,Ellipsis,FunctionDefArgument,FunctionExpression,ClassDefinition,TryCatch,SuperStatement,BlockWithoutIndent,SimpleWaitForStatement,WaitForStatement,PauseForStatement,MultipleReturnValues,RunInParallelBlock,WaitForExpression,Variable],exports.Grammar={},kobj$3=Nodes,ki$3=0;kobj$3.length>ki$3;ki$3++)v=kobj$3[ki$3],exports.Grammar[v.name]=v;exports.GrammarRoot=exports.Grammar.File,exports.KEYWORDS=KEYWORDS,exports.RVALUE_OK=RVALUE_OK})();